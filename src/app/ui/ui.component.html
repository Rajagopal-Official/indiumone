<mat-toolbar>
  <button mat-icon-button (click)="toggleSidenav()" matTooltip="Toggle Menu">
    <mat-icon>menu</mat-icon>
  </button>
  <span class="logo">
    <div style="margin-right: 20px">
      <img
        src="../../assets/IndiumLogo.png"
        alt="Indium Logo"
        style="height: 65px; width: 70px"
      />
    </div>
    Indium One
  </span>
  <button
    mat-icon-button
    [matMenuTriggerFor]="appsMenu"
    class="apps-menu-btn"
    matTooltip="Click here to see the top applications"
  >
    <!--  matMenuTriggerFor Binds a button to a menu. -->
    <mat-icon>apps</mat-icon>
  </button>
  <mat-menu #appsMenu="matMenu" class="apps-menu" [overlapTrigger]="false">
    <div class="apps-grid">
      @for (app of apps; track app.name) {
      <div class="app-item">
        <div class="app-icon" [style.background]="app.bgColor">
          <mat-icon>{{ app.icon }}</mat-icon>
        </div>
        <span class="app-name">{{ app.name }}</span>
        <span class="app-description">{{ app.description }}</span>
      </div>
      }
    </div>
  </mat-menu>
  <span class="spacer"></span>
  @if(showSearchField()){
  <mat-form-field
    appearance="outline"
    style="width: 250px !important ; padding: 5px !important; margin-top: 30px"
    class="small"
  >
    <input
      matInput
      [(ngModel)]="searchTerm"
      (ngModelChange)="searchApps()"
      placeholder="Search applications..."
      style="padding-left: 15px; color: black"
    />
  </mat-form-field>
  }
  <button mat-icon-button matTooltip="Search" (click)="toggleSearchField()">
    <mat-icon>search</mat-icon>
  </button>
  <button mat-icon-button matTooltip="Toggle Theme">
    <mat-icon>dark_mode</mat-icon>
  </button>
  <button
    mat-icon-button
    [matMenuTriggerFor]="notificationsMenu"
    class="notification-btn"
    matTooltip="Click here to access notifications"
  >
    <mat-icon [matBadge]="'3'" matBadgeColor="warn">notifications</mat-icon>
  </button>
  <mat-menu #notificationsMenu="matMenu" class="notifications-menu">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button mat-button color="primary">Mark all as read</button>
    </div>
    @for (notification of notifications; track notification.id) {
    <div class="notification-item" [class.unread]="notification.unread">
      <mat-icon [class]="notification.iconClass">{{
        notification.icon
      }}</mat-icon>
      <div class="notification-content">
        <p class="notification-text">{{ notification.text }}</p>
        <span class="notification-time">{{ notification.time }}</span>
      </div>
    </div>
    }
  </mat-menu>
  <div
    class="user-profile"
    [matMenuTriggerFor]="logout"
    matTooltip="Click here to logout"
  >
    <mat-icon>exit_to_app</mat-icon>
  </div>
  <mat-menu #logout="matMenu" class="apps-menu" [overlapTrigger]="false">
    <button
      mat-icon-button
      style="display: flex; gap: 8px; width: 150px; height: 50px"
      (click)="logout"
    >
      <mat-icon>logout</mat-icon> Logout
    </button>
  </mat-menu>
</mat-toolbar>

<mat-sidenav-container>
  <mat-sidenav [opened]="sidenavOpen()" mode="side" class="sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Navigation</h2>
    </div>
    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
      <mat-tree-node
        *matTreeNodeDef="let node"
        matTreeNodePadding
        style="background-color: black"
      >
        <mat-icon *ngIf="node.icon">{{ node.icon }}</mat-icon>
        <span
          (click)="applicationsList()"
          style="cursor: pointer; color: white"
          >{{ node.name }}</span
        >
      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <div class="mat-tree-node">
          <button mat-icon-button matTreeNodeToggle>
            <mat-icon>
              {{
                treeControl.isExpanded(node) ? "expand_more" : "chevron_right"
              }}
            </mat-icon>
          </button>
          <mat-icon *ngIf="node.icon">{{ node.icon }}</mat-icon>
          <span>{{ node.name }}</span>
        </div>
        <div
          [class.tree-invisible]="!treeControl.isExpanded(node)"
          role="group"
        >
          <ng-container matTreeNodeOutlet></ng-container>
        </div>
      </mat-nested-tree-node>
    </mat-tree>

    <mat-nav-list>
      @for (item of menuItems(); track item.text) {
      <a mat-list-item matRipple [matTooltip]="item.text">
        <mat-icon matListItemIcon [class]="item.color">{{
          item.icon
        }}</mat-icon>
        <span matListItemTitle>{{ item.text }}</span>
        @if (item.badge) {
        <span class="menu-badge">{{ item.badge }}</span>
        }
      </a>
      }
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content>
    <div style="padding: 12px">
      <div class="page-header">
        <h1>Dashboard Overview</h1>
        <p class="subtitle">Welcome back! Here's what's happening today.</p>
      </div>

      <section
        [class]="sidenavOpen() ? 'grid-container' : 'grid-container-expanded'"
      >
        @if(isLoading()){
        <div
          style="
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
          "
        >
          <mat-spinner></mat-spinner>
          <p style="font-weight: bold">
            Loading the list of Authorized Applications
          </p>
        </div>
        } @else{ @for (item of filteredItems(); track item.title) {
        <div class="grid-item">
          <div class="image-container">
            <img [src]="item.image" [alt]="item.title" />
            <span class="department-badge">{{ item.department }}</span>
            <span class="description-badge">Short Description</span>
          </div>
          <div class="content">
            <h3>{{ item.title }}</h3>
            <p>{{ item.description }}</p>
            <div class="actions">
              <a
                [href]="item.link"
                target="_blank"
                class="action-button primary"
              >
                Access
              </a>
              <a target="_blank" class="action-button secondary"> Demo </a>
            </div>
          </div>
        </div>
        } }
      </section>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
