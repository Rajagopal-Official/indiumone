<app-navbar></app-navbar>
<mat-sidenav-container>
  <mat-sidenav [opened]="sidenavOpen()" mode="side" class="sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Departments by Categories</h2>
    </div>
    <div class="mat-tree-node" (click)="selectDepartment(allDepartment.name)">
      <span class="department-name">
        <mat-icon>{{ allDepartment.icon }}</mat-icon>
        {{ allDepartment.name }}</span
      >
    </div>

    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <div class="mat-tree-node" (click)="selectDepartment(node.name)">
          <mat-icon *ngIf="node.icon" class="department-icon">{{
            node.icon
          }}</mat-icon>
          <span class="department-name">{{ node.name }}</span>
          <button mat-icon-button matTreeNodeToggle>
            <mat-icon>
              {{
                treeControl.isExpanded(node) ? "expand_more" : "chevron_right"
              }}
            </mat-icon>
          </button>
        </div>
        <div
          class="mat-tree-children"
          [class.tree-invisible]="!treeControl.isExpanded(node)"
          role="group"
        >
          <ng-container matTreeNodeOutlet></ng-container>
        </div>
      </mat-nested-tree-node>

      <mat-tree-node
        *matTreeNodeDef="let node"
        matTreeNodePadding
        class="submenu-item"
        (click)="node.name === 'Applications' ? applicationsList() : null"
      >
        <mat-icon *ngIf="node.icon" class="submenu-icon">{{
          node.icon
        }}</mat-icon>
        <span class="submenu-name">{{ node.name }}</span>
      </mat-tree-node>
    </mat-tree>
  </mat-sidenav>

  <mat-sidenav-content>
    <div style="padding: 12px">
      <div class="page-header">
        <h1>Appstore built for us and built by us!!</h1>
        <p class="subtitle">
          Hello, {{ getDisplayName() }}! Welcome to the Indium App Store.
        </p>
        <div style="display: flex; justify-content: flex-end; width: 100%">
          <p
            style="
              margin-top: 17px;
              font-size: 18px;
              font-weight: 450;
              font-style: italic;
              margin-right: 20px;
            "
          >
            Apps that power your productivity journey! âš¡
          </p>
        </div>
      </div>

      <section
        [class]="sidenavOpen() ? 'grid-container' : 'grid-container-expanded'"
      >
        @if(isLoading()){
        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
          "
        >
          <mat-spinner></mat-spinner>
          <p style="font-weight: bold; margin-top: 16px">
            Loading the list of Authorized Applications
          </p>
        </div>
        } @else { @if(filteredItems().length === 0) {
        <div class="no-apps-message">
          <mat-icon>info</mat-icon>
          <p>No applications available in this category</p>
        </div>
        } @else { @for (item of filteredItems(); track item.title) {
        <div class="grid-item">
          @if(isLoading()){
          <mat-spinner diameter="40"></mat-spinner>
          } @else{
          <div class="image-container">
            <img [src]="item.image" [alt]="item.title" />
          </div>
          }
          <div class="content">
            <h3>{{ item.title }}</h3>
            <p>{{ item.description }}</p>
            <div class="actions">
              <div style="display: flex; gap: 10px">
                <a
                  [href]="item.link"
                  target="_blank"
                  class="action-button primary"
                  style="
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    color: #555843;
                  "
                >
                  Access
                  <mat-icon style="font-size: 20px">send</mat-icon>
                </a>
              </div>
              <div style="display: flex; gap: 10px">
                <a
                  [href]="item.demoUrl"
                  target="_blank"
                  class="action-button secondary"
                  [class.disabled]="!item.demoUrl"
                  [attr.title]="!item.demoUrl ? 'Demo not available' : ''"
                  style="
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    color: #555843;
                  "
                >
                  Demo
                  <mat-icon style="font-size: 20px"
                    >play_circle_filled</mat-icon
                  >
                </a>
              </div>
            </div>
            <div class="dev-team">
              Developed by: {{ item.devTeam || "Organization Dev Team" }}
            </div>
            <div class="rating">
              @for (i of [1, 2, 3, 4, 5]; track i) {
              <mat-icon
                (click)="rateApplication(item, i)"
                [ngClass]="{ filled: ratings()[item.title] >= i }"
              >
                star
              </mat-icon>
              }
            </div>
          </div>
        </div>
        } } }
      </section>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
